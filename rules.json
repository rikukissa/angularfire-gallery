{
    "rules": {
        ".read": false,
        ".write": false,
        "users": {
          ".read": true,
          ".write": "!data.exists()",
          "$userId": {
            ".write": "auth != null && auth.id == $userId",
            ".validate": "auth.id == $userId"
          }
        },
        "files": {
          ".write": "auth != null && !data.exists()",
          ".read": "auth != null",
          "$fileId": {
            ".write": "auth != null && (!data.exists() || auth.id == data.child('user_id').val())",
            ".validate": "newData.hasChildren(['user_id', 'link', 'file_type', 'timestamp', 'thumbnail', 'service']) && auth.id == newData.child('user_id').val()",
            "file_type": {
              ".validate": "newData.val() === 'video' || newData.val() === 'image'"
            },
            "service": {
              ".validate": "newData.val() === 'imgur' || newData.val() === 'youtube'"
            },
            "link": {
              ".validate": "newData.isString() && ((newData.parent().child('service').val() === 'youtube' && newData.val().contains('youtube.com')) || (newData.parent().child('service').val() === 'imgur' && newData.val().contains('imgur.com')))"
            },
            "thumbnail": {
              ".validate": "newData.isString() && ((newData.parent().child('service').val() === 'youtube' && newData.val().contains('youtube.com')) || (newData.parent().child('service').val() === 'imgur' && newData.val().contains('imgur.com')))"
            },
            "timestamp": {
              ".validate": "newData.isNumber() && newData.val() <= now"
            }
         }
        }
    }
}
